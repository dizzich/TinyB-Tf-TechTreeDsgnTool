# Edge Routing Prompt (RU)

Промпт для LLM, который упорядочивает связи между нодами, устраняет лишние ступеньки/заломы и выдает готовые waypoints для `manualEdgeMode`.

## Готовый промпт
```
Ты ассистент по маршрутизации связей в ортогональном редакторе. Тебе дают: nodes[{id,x,y,width,height}] с портами target слева, source справа; edges[{id,source,target,waypoints?}]. Твоя задача — вернуть waypoints и pathType для каждого edge, чтобы линии были ровные и читаемые.

Правила прокладки:
- Держи маршруты ортогональными, шаг сетки grid (px). Минимизируй количество колен: прямой путь > 1 колено > 2 колена, больше — только если нужно обойти препятствия.
- Ставь отступ clearance от рамок нод. Выход из порта: сначала отойди на portOffset по оси порта, затем поворачивай.
- Избегай ступенек: если две последовательные линии по одной оси короче shortMerge, объединяй в одну прямую.
- Расстояние между параллельными линиями одной связи делай ≥ parallelGap, чтобы светящиеся линии не сливались.
- Не веди линию через ноду: если прямой отрезок пересекает bounding box другой ноды, прокладывай обход (два поворота вокруг коробки) с сохранением clearance.
- Для почти горизонтальных/вертикальных отрезков сдвигай координаты до сетки (округляй к ближайшему значению кратному grid).

Формат вывода:
{ "edges": [ { "id": edgeId, "pathType": "step"|"smoothstep", "waypoints": [ { "x": number, "y": number }, ... ] } ] }
waypoints перечисляют промежуточные углы от source к target. Не добавляй точки на сам порт.

Параметры по умолчанию: grid=8, clearance=6, portOffset=8, shortMerge=12, parallelGap=10. Используй их, если не переданы явно.
Возвращай только JSON с edges, без текста.
```

## Входные данные для LLM
- `nodes`: `{ id, x, y, width, height }`, где `x,y` — левый верхний угол.
- `edges`: `{ id, source, target, waypoints? }`. `waypoints` могут быть пустыми — значит нужно рассчитать заново.
- Опционально можно передать параметры `grid`, `clearance`, `portOffset`, `shortMerge`, `parallelGap`.

## Пример запроса
```json
{
  "grid": 8,
  "clearance": 8,
  "nodes": [
    { "id": "A", "x": 100, "y": 180, "width": 220, "height": 64 },
    { "id": "B", "x": 420, "y": 260, "width": 220, "height": 64 }
  ],
  "edges": [
    { "id": "A->B", "source": "A", "target": "B" }
  ]
}
```

## Пример ответа
```json
{
  "edges": [
    {
      "id": "A->B",
      "pathType": "step",
      "waypoints": [
        { "x": 320, "y": 212 },
        { "x": 320, "y": 292 }
      ]
    }
  ]
}
```

